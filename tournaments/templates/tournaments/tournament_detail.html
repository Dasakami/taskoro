{% extends "base.html" %}

{% block title %}{{ tournament.title }} | Magic RPG Tracker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/vendor/css/tournaments.css">
{% endblock %}

{% block content %}
<div class="tournament-detail-container">
    <div class="tournament-detail-header reveal">
        <div class="back-link">
            <a href="{% url 'tournaments:tournaments' %}" class="btn-small">
                <span class="back-icon">‚Üê</span>
                <span class="back-text">–ö —Å–ø–∏—Å–∫—É —Ç—É—Ä–Ω–∏—Ä–æ–≤</span>
            </a>
        </div>
        <h1 class="text-gradient">{{ tournament.title }}</h1>
    </div>

    <div class="tournament-detail-content">
        <div class="tournament-detail-main card reveal">
            <div class="card-header">
                <div class="tournament-status-badge 
                    {% if tournament.has_ended %}ended
                    {% elif tournament.is_active %}active
                    {% else %}upcoming{% endif %}">
                    {% if tournament.has_ended %}–ó–∞–≤–µ—Ä—à–µ–Ω
                    {% elif tournament.is_active %}–ê–∫—Ç–∏–≤–µ–Ω
                    {% else %}–°–∫–æ—Ä–æ{% endif %}
                </div>
            </div>
            <div class="card-body">
                <div class="tournament-description">
                    <p>{{ tournament.description|linebreaks }}</p>
                </div>
                
                <div class="tournament-meta">
                    <div class="meta-section">
                        <h3 class="meta-title">–í—Ä–µ–º—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</h3>
                        <div class="meta-content time-info">
                            <div class="meta-item">
                                <span class="meta-label">–ù–∞—á–∞–ª–æ:</span>
                                <span class="meta-value">{{ tournament.start_date|date:"d.m.Y H:i" }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">–û–∫–æ–Ω—á–∞–Ω–∏–µ:</span>
                                <span class="meta-value">{{ tournament.end_date|date:"d.m.Y H:i" }}</span>
                            </div>
                            {% if tournament.is_active %}
                            <div class="meta-item highlight">
                                <span class="meta-label">–û—Å—Ç–∞–ª–æ—Å—å:</span>
                                <span class="meta-value">{{ tournament.end_date|timeuntil }}</span>
                            </div>
                            {% elif not tournament.has_started %}
                            <div class="meta-item highlight">
                                <span class="meta-label">–î–æ –Ω–∞—á–∞–ª–∞:</span>
                                <span class="meta-value">{{ tournament.start_date|timeuntil }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="meta-section">
                        <h3 class="meta-title">–£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è</h3>
                        <div class="meta-content">
                            <div class="meta-item">
                                <span class="meta-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á:</span>
                                <span class="meta-value">{{ tournament.min_tasks_completed }}</span>
                            </div>
                            <div class="meta-text">
                                <p>–î–ª—è –ø–æ–±–µ–¥—ã –≤ —Ç—É—Ä–Ω–∏—Ä–µ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –æ—á–∫–∏. –ó–∞ –∫–∞–∂–¥—É—é –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 10 –æ—á–∫–æ–≤.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="meta-section">
                        <h3 class="meta-title">–ù–∞–≥—Ä–∞–¥—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º</h3>
                        <div class="meta-content rewards-list">
                            <div class="reward-item large">
                                <div class="reward-icon">‚≠ê</div>
                                <div class="reward-info">
                                    <div class="reward-title">–û–ø—ã—Ç</div>
                                    <div class="reward-value">{{ tournament.experience_reward }} XP</div>
                                </div>
                            </div>
                            <div class="reward-item large">
                                <div class="reward-icon">üí∞</div>
                                <div class="reward-info">
                                    <div class="reward-title">–ú–æ–Ω–µ—Ç—ã</div>
                                    <div class="reward-value">{{ tournament.coins_reward }}</div>
                                </div>
                            </div>
                            <div class="reward-item large">
                                <div class="reward-icon">üíé</div>
                                <div class="reward-info">
                                    <div class="reward-title">–ö—Ä–∏—Å—Ç–∞–ª–ª—ã</div>
                                    <div class="reward-value">{{ tournament.gems_reward }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                {% if is_participating %}
                <div class="participation-info">
                    <div class="info-text">
                        <span class="info-icon">‚úì</span>
                        <span>–í—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ —ç—Ç–æ–º —Ç—É—Ä–Ω–∏—Ä–µ</span>
                    </div>
                    {% if participant %}
                    <div class="user-stats">
                        <div class="stat-item">
                            <span class="stat-label">–í–∞—à —Å—á–µ—Ç:</span>
                            <span class="stat-value">{{ participant.score }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á:</span>
                            <span class="stat-value">{{ participant.tasks_completed }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">–¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ:</span>
                            <span class="stat-value">{{ user_rank }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% elif tournament.is_active %}
                <a href="{% url 'tournaments:tournament_join' tournament.id %}" class="btn pulse">–ü—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ</a>
                {% elif not tournament.has_started %}
                <button class="btn btn-secondary" disabled>–¢—É—Ä–Ω–∏—Ä –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª—Å—è</button>
                {% else %}
                <button class="btn btn-secondary" disabled>–¢—É—Ä–Ω–∏—Ä –∑–∞–≤–µ—Ä—à–µ–Ω</button>
                {% endif %}
            </div>
        </div>
        
        <div class="tournament-leaderboard card reveal">
            <div class="card-header">
                <h2>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
            </div>
            <div class="card-body">
                {% if leaderboard %}
                <div class="leaderboard-content">
                    <div class="leaderboard-header">
                        <div class="leaderboard-col rank">–ú–µ—Å—Ç–æ</div>
                        <div class="leaderboard-col player">–ò–≥—Ä–æ–∫</div>
                        <div class="leaderboard-col score">–°—á–µ—Ç</div>
                    </div>
                    <div class="leaderboard-body">
                        {% for participant in leaderboard %}
                        <div class="leaderboard-row {% if participant.user == user %}current-user{% endif %}">
                            <div class="leaderboard-col rank">
                                {% if forloop.counter == 1 %}
                                <span class="rank-badge gold">1</span>
                                {% elif forloop.counter == 2 %}
                                <span class="rank-badge silver">2</span>
                                {% elif forloop.counter == 3 %}
                                <span class="rank-badge bronze">3</span>
                                {% else %}
                                <span class="rank-number">{{ forloop.counter }}</span>
                                {% endif %}
                            </div>
                            <div class="leaderboard-col player">{{ participant.user.username }}</div>
                            <div class="leaderboard-col score">{{ participant.score }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —ç—Ç–æ–º —Ç—É—Ä–Ω–∏—Ä–µ.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}