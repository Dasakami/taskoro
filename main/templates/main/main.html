{% extends "base.html" %}
{% load static %}

{% block title %} Taskoro ‚Äî –ò–≥—Ä–æ–≤–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ –ø—Ä–∏–≤—ã—á–µ–∫ {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/vendor/css/dashboard.css">
{% endblock %}
{% block seo %}
<meta name="description" content="–ü–æ–≥—Ä—É–∑–∏—Å—å –≤ –º–∏—Ä Taskoro ‚Äî —Å–æ–∑–¥–∞–≤–∞–π –∑–∞–¥–∞—á–∏, —Å–æ—Ä–µ–≤–Ω—É–π—Å—è –≤ –¥—É—ç–ª—è—Ö –∏ —Ç—É—Ä–Ω–∏—Ä–∞—Ö, —É–ø—Ä–∞–≤–ª—è–π –ø—Ä–∏–≤—ã—á–∫–∞–º–∏ –∏ —Ä–∞–∑–≤–∏–≤–∞–π—Å—è –∫–∞–∫ –≥–µ—Ä–æ–π!">
<meta name="keywords" content="–ø—Ä–æ–∫–∞—á–∫–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, —Ç—Ä–µ–∫–µ—Ä –∑–∞–¥–∞—á, –∏–≥—Ä–æ–≤–æ–π —Ç—Ä–µ–∫–µ—Ä, –¥—É—ç–ª–∏, –ø—Ä–∏–≤—ã—á–∫–∏, –º–æ—Ç–∏–≤–∞—Ü–∏—è, —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ, Taskoro">
<meta name="robots" content="index, follow">
<meta name="author" content="Dan Dasakami">

<!-- Open Graph -->
<meta property="og:title" content="Taskoro ‚Äî –ò–≥—Ä–æ–≤–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ –ø—Ä–∏–≤—ã—á–µ–∫">
<meta property="og:description" content="–ü–æ–≥—Ä—É–∑–∏—Å—å –≤ –º–∏—Ä Taskoro ‚Äî —Å–æ–∑–¥–∞–≤–∞–π –∑–∞–¥–∞—á–∏, —Å–æ—Ä–µ–≤–Ω—É–π—Å—è –≤ –¥—É—ç–ª—è—Ö –∏ —Ç—É—Ä–Ω–∏—Ä–∞—Ö, —É–ø—Ä–∞–≤–ª—è–π –ø—Ä–∏–≤—ã—á–∫–∞–º–∏ –∏ —Ä–∞–∑–≤–∏–≤–∞–π—Å—è –∫–∞–∫ –≥–µ—Ä–æ–π!">
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Taskoro ‚Äî –ò–≥—Ä–æ–≤–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ –ø—Ä–∏–≤—ã—á–µ–∫">
<meta name="twitter:description" content="–ü–æ–≥—Ä—É–∑–∏—Å—å –≤ –º–∏—Ä Taskoro ‚Äî —Å–æ–∑–¥–∞–≤–∞–π –∑–∞–¥–∞—á–∏, —Å–æ—Ä–µ–≤–Ω—É–π—Å—è –≤ –¥—É—ç–ª—è—Ö –∏ —Ç—É—Ä–Ω–∏—Ä–∞—Ö, —É–ø—Ä–∞–≤–ª—è–π –ø—Ä–∏–≤—ã—á–∫–∞–º–∏ –∏ —Ä–∞–∑–≤–∏–≤–∞–π—Å—è –∫–∞–∫ –≥–µ—Ä–æ–π!">
<meta name="twitter:image" content="">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header reveal">
        
        <div class="3d-and-h1-flex" style="display: flex;align-items: center;justify-content: center;">
            <h1 class="text-gradient">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}
        </h1>
            <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
<model-viewer src="{% static 'vendor/models/igris_solo_leveling.glb' %}" ar ar-modes="webxr scene-viewer quick-look" camera-controls tone-mapping="neutral"  shadow-intensity="1" camera-orbit="8.049deg 89.27deg 6.964m" field-of-view="30deg">
    <div class="progress-bar hide" slot="progress-bar">
        <div class="update-bar"></div>
    </div>
    <button slot="ar-button" id="ar-button">
    </button>
</model-viewer>
        </div>
        <div class="player-stats">
            <div class="player-level">
                <div class="level-circle magic-circle">
                    <span class="level-number">{{ profile.level }}</span>
                </div>
                <div class="level-text">–£—Ä–æ–≤–µ–Ω—å</div>
            </div>
            <div class="player-exp">
                <div class="exp-bar-container">
                    <div class="progress progress-animated">
                        <div class="progress-bar"  data-value="{{ profile.experience }}" data-max="{{ profile.experience_needed }}"></div>
                    </div>
                </div>
                <div class="exp-text">{{ profile.experience }} / {{ profile.experience_needed }} XP</div>
            </div>
            <div class="player-currencies">
                <div class="currency-item">
                    <span class="currency-icon">üí∞</span>
                    <span class="currency-amount">{{ profile.coins }}</span>
                </div>
                <div class="currency-item">
                    <span class="currency-icon">üíé</span>
                    <span class="currency-amount">{{ profile.gems }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="dashboard-section daily-mission card reveal">
            <div class="card-header">
                <h2>–¢–≤–æ—è –º–∏—Å—Å–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
            </div>
            <div class="card-body">
                <div class="mission-content">
                    <h3 class="mission-title">{{ daily_mission.title }}</h3>
                    <p class="mission-description">{{ daily_mission.description }}</p>
                    <div class="mission-rewards">
                        <div class="reward-item">
                            <span class="reward-icon">‚≠ê</span>
                            <span class="reward-value">{{ daily_mission.experience_reward }} XP</span>
                        </div>
                        <div class="reward-item">
                            <span class="reward-icon">üí∞</span>
                            <span class="reward-value">{{ daily_mission.coins_reward }}</span>
                        </div>
                    </div>
                </div>
                <div class="mission-action">

                </div>
            </div>
        </div>

        <div class="dashboard-section motivation-quote card reveal">
            <div class="card-header">
                <h2>–ú–æ—Ç–∏–≤–∞—Ü–∏—è –¥–Ω—è</h2>
            </div>
            <div class="card-body">
                <div class="quote-container magic-circle">
                    <p class="quote-text">"{{ daily_motivation.text }}"</p>
                    {% if daily_motivation.author %}
                    <p class="quote-author">‚Äî {{ daily_motivation.author }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="dashboard-section progress-chart card reveal">
            <div class="card-header">
                <h2>–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
            </div>
            <div class="card-body">
                <div class="crystal-ball">
                    <div class="daily-stats">
                        <div class="stat-card">
                            <div class="stat-value">{{ completed_tasks_today }}</div>
                            <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ profile.streak }}</div>
                            <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                        </div>
                    </div>
                    <div class="progress-circle-container">
                        <div class="progress-circle">
                            <svg viewBox="0 0 36 36" class="circular-chart">
                                <path class="circle-bg"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                />
                                <path class="circle"
                                    stroke-dasharray="{{ completed_tasks_today|default:0 }}, 100"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                />
                                <text x="18" y="20.35" class="percentage">{{ completed_tasks_today|default:0 }}%</text>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-section recent-tasks card reveal">
            <div class="card-header">
                <h2>–ù–µ–¥–∞–≤–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>
            </div>
            <div class="card-body">
                {% if recent_tasks %}
                <ul class="task-list">
                    {% for task in recent_tasks %}
                    <li class="task-item {% if task.is_completed %}completed{% endif %}">
                        <div class="task-status">
                            <span class="status-icon">{% if task.is_completed %}‚úÖ{% else %}‚è≥{% endif %}</span>
                        </div>
                        <div class="task-info">
                            <div class="task-title">{{ task.title }}</div>
                            <div class="task-date">{{ task.created_at|date:"d.m.Y" }}</div>
                        </div>
                        <div class="task-action">
                            <a href="{% url 'tasks:task_detail' task.id %}" class="btn-small">–û—Ç–∫—Ä—ã—Ç—å</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="empty-state">
                    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É!</p>
                    <a href="{% url 'tasks:task_create' %}" class="btn">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
                </div>
                {% endif %}
            </div>
            <div class="card-footer">
                <a href="{% url 'tasks:tasks' %}" class="btn btn-secondary">–í—Å–µ –∑–∞–¥–∞—á–∏</a>
            </div>
        </div>

        <div class="dashboard-section active-tournaments card reveal">
            <div class="card-header">
                <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã</h2>
            </div>
            <div class="card-body">
                {% if active_tournaments %}
                <ul class="tournament-list">
                    {% for tournament in active_tournaments %}
                    <li class="tournament-item">
                        <div class="tournament-info">
                            <div class="tournament-title">{{ tournament.title }}</div>
                            <div class="tournament-deadline">–ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è: {{ tournament.end_date|date:"d.m.Y" }}</div>
                        </div>
                        <div class="tournament-action">
                            <a href="{% url 'tournaments:tournament_detail' tournament.id %}" class="btn-small">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="empty-state">
                    <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç.</p>
                </div>
                {% endif %}
            </div>
            <div class="card-footer">
                <a href="{% url 'tournaments:tournaments' %}" class="btn btn-secondary">–í—Å–µ —Ç—É—Ä–Ω–∏—Ä—ã</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Calculate progress percentage
        const progressPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        // Update circular progress
        const circle = document.querySelector('.circle');
        if (circle) {
            circle.setAttribute('stroke-dasharray', `${progressPercentage}, 100`);
        }
        
        const percentageText = document.querySelector('.percentage');
        if (percentageText) {
            percentageText.textContent = `${progressPercentage}%`;
        }
    });
</script>

<style>
    model-viewer {
  width: 100%;
  max-width: 400px;
  height: 400px;
  margin: 0 auto;
  display: block;
}

</style>
{% endblock %}