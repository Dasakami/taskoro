{% extends 'base.html' %}
{% load static %}

{% block title %}–°—É–Ω–¥—É–∫–∏ | –ú–∞–≥–∞–∑–∏–Ω | Taskoro{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'vendor/css/sho.css' %}">
{% endblock %}

{% block content %}
<div class="shop-container">
    <div class="shop-header">
        <h1 class="shop-title">–°—É–Ω–¥—É–∫–∏</h1>
        <div class="user-currency">
            <div class="currency coins">
                <span class="currency-icon">üí∞</span>
                <span class="currency-amount">{{ request.user.profile.coins }}</span>
            </div>
            <div class="currency gems">
                <span class="currency-icon">üíé</span>
                <span class="currency-amount">{{ request.user.profile.gems }}</span>
            </div>
        </div>
    </div>

    <div class="shop-navigation">
        <ul class="shop-categories">
            <li><a href="{% url 'shop:shop' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
            {% for cat_value, cat_name in shop_item_categories %}
            <li><a href="{% url 'shop:shop_category' category=cat_value %}">{{ cat_name }}</a></li>
            {% endfor %}
            <li><a href="{% url 'shop:chest_list' %}" class="active">–°—É–Ω–¥—É–∫–∏</a></li>
            <li><a href="{% url 'shop:user_inventory' %}">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</a></li>
        </ul>
    </div>

    <section class="chests-container">
        <div class="chests-grid">
            {% for chest in chests %}
            <div class="chest-card" data-rarity="{{ chest.rarity }}">
                <div class="chest-header">
                    <h3 class="chest-name">{{ chest.name }}</h3>
                    <span class="chest-rarity rarity-{{ chest.rarity }}">{{ chest.get_rarity_display }}</span>
                </div>
                
                <div class="chest-image">
                    {% if chest.rarity == 'common' %}
                    <span class="chest-icon">üì¶</span>
                    {% elif chest.rarity == 'rare' %}
                    <span class="chest-icon">üéÅ</span>
                    {% elif chest.rarity == 'epic' %}
                    <span class="chest-icon">üíé</span>
                    {% elif chest.rarity == 'legendary' %}
                    <span class="chest-icon">üëë</span>
                    {% endif %}
                </div>
                
                <div class="chest-description">
                    <p>{{ chest.description }}</p>
                </div>
                
                <div class="chest-rewards">
                    <p class="rewards-title">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</p>
                    <div class="rewards-details">
                        <p class="coin-rewards">
                            <span class="reward-icon">üí∞</span> {{ chest.min_coins_reward }} - {{ chest.max_coins_reward }}
                        </p>
                        <p class="gem-rewards">
                            <span class="reward-icon">üíé</span> {{ chest.min_gems_reward }} - {{ chest.max_gems_reward }}
                        </p>
                    </div>
                </div>
                
                <div class="chest-price">
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å:</p>
                    <div class="price-details">
                        <span class="price-icon">üí∞</span> {{ chest.price_coins }}
                        <span class="price-icon gems">üíé</span> {{ chest.price_gems }}
                    </div>
                </div>
                
                <form action="{% url 'shop:open_chest' chest_id=chest.id %}" method="post" class="chest-form">
                    {% csrf_token %}
                    <button type="submit" class="open-chest-button" data-chest-id="{{ chest.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                </form>
            </div>
            {% empty %}
            <p class="empty-message">–°—É–Ω–¥—É–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</p>
            {% endfor %}
        </div>
    </section>
</div>

<!-- Chest Opening Animation Modal -->
<div id="chest-opening-modal" class="modal">
    <div class="modal-content">
        <div class="chest-opening-animation">
            <div class="chest-image-large">
                <span class="chest-icon-large">üì¶</span>
            </div>
            <div class="opening-text">–û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—É–Ω–¥—É–∫...</div>
            <div class="rewards-container" style="display: none;">
                <h3>–í–∞—à–∏ –Ω–∞–≥—Ä–∞–¥—ã:</h3>
                <div class="reward coin-reward">
                    <span class="reward-icon">üí∞</span>
                    <span class="reward-amount" id="coin-reward-amount">0</span>
                </div>
                <div class="reward gem-reward">
                    <span class="reward-icon">üíé</span>
                    <span class="reward-amount" id="gem-reward-amount">0</span>
                </div>
                <button id="close-chest-modal" class="close-button">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'vendor/js/chest.js' %}"></script>
{% endblock %}