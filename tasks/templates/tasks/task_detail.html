{% extends "base.html" %}

{% block title %}{{ task.title }} | Magic RPG Tracker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/vendor/css/tasks.css">
{% endblock %}

{% block content %}
<div class="task-detail-container">
    <div class="task-detail-header reveal">
        <div class="back-link">
            <a href="{% url 'tasks:tasks' %}" class="btn-small">
                <span class="back-icon">‚Üê</span>
                <span class="back-text">–ö —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á</span>
            </a>
        </div>
        <h1 class="text-gradient">{{ task.title }}</h1>
    </div>

    <div class="task-detail-content">
        <div class="task-detail-main card reveal">
            <div class="card-header">
                <div class="task-header-info">
                    <div class="task-header-status">
                        <span class="status-label">–°—Ç–∞—Ç—É—Å:</span>
                        <span class="status-value {% if task.is_completed %}completed{% elif task.is_overdue %}overdue{% endif %}">
                            {% if task.is_completed %}‚úÖ
                            {% elif task.is_overdue %}‚ö†Ô∏è
                            {% elif task.status == 'in_progress' %}‚è≥
                            {% elif task.status == 'waiting' %}‚è∏Ô∏è
                            {% else %}üîÑ
                            {% endif %}
                            {{ task.get_status_display_custom }}
                        </span>
                    </div>
                    {% if task.category %}
                    <div class="task-header-category">
                        <span class="category-badge">
                            {{ task.category.name }}
                        </span>
                    </div>
                    {% endif %}
                </div>
                <div class="task-header-actions">
                    <a href="{% url 'tasks:task_edit' task.id %}" class="btn-small">
                        <span class="action-icon">‚úèÔ∏è</span>
                        <span class="action-text">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
                    </a>
                    <a href="{% url 'tasks:task_delete' task.id %}" class="btn-small btn-danger">
                        <span class="action-icon">üóëÔ∏è</span>
                        <span class="action-text">–£–¥–∞–ª–∏—Ç—å</span>
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="task-difficulty-badge" >
                    {{ task.get_difficulty_display }}
                </div>
                
                {% if task.description %}
                <div class="task-description">
                    {{ task.description|linebreaks }}
                </div>
                {% else %}
                <div class="task-description empty">
                    <p>–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
                </div>
                {% endif %}
                
                <div class="task-metadata">
                    <div class="metadata-item">
                        <span class="metadata-label">–°–æ–∑–¥–∞–Ω–æ:</span>
                        <span class="metadata-value">{{ task.created_at|date:"d.m.Y H:i" }}</span>
                    </div>
                    
                    {% if task.deadline %}
                    <div class="metadata-item">
                        <span class="metadata-label">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</span>
                        <span class="metadata-value {% if task.is_overdue %}overdue{% endif %}">
                            {{ task.deadline|date:"d.m.Y H:i" }}
                        </span>
                    </div>
                    {% endif %}
                    
                    <div class="metadata-item">
                        <span class="metadata-label">–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è:</span>
                        <span class="metadata-value">{{ task.estimated_minutes }} –º–∏–Ω.</span>
                    </div>
                    
                    {% if task.is_completed and task.completed_at %}
                    <div class="metadata-item">
                        <span class="metadata-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ:</span>
                        <span class="metadata-value completed">{{ task.completed_at|date:"d.m.Y H:i" }}</span>
                    </div>
                    
                    {% if task.actual_minutes %}
                    <div class="metadata-item">
                        <span class="metadata-label">–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è:</span>
                        <span class="metadata-value">{{ task.actual_minutes }} –º–∏–Ω.</span>
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
            <div class="card-footer">
                {% if not task.is_completed %}
                <a href="{% url 'tasks:task_complete' task.id %}?next={% url 'tasks:task_detail' task.id %}" class="btn pulse">
                    <span class="btn-icon">‚úì</span>
                    <span class="btn-text">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É</span>
                </a>
                {% else %}
                <button class="btn btn-secondary" disabled>
                    <span class="btn-icon">‚úì</span>
                    <span class="btn-text">–ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                </button>
                {% endif %}
            </div>
        </div>
        
        <div class="task-detail-sidebar reveal">
            <div class="sidebar-card card">
                <div class="card-header">
                    <h3>–í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</h3>
                </div>
                <div class="card-body">
                    <div class="rewards-list">
                        <div class="reward-item">
                            <div class="reward-icon">‚≠ê</div>
                            <div class="reward-info">
                                <div class="reward-title">–û–ø—ã—Ç</div>
                                <div class="reward-value">
                                    {% if task.difficulty == 'easy' %}20
                                    {% elif task.difficulty == 'medium' %}40
                                    {% elif task.difficulty == 'hard' %}80
                                    {% elif task.difficulty == 'epic' %}150
                                    {% else %}30
                                    {% endif %} XP
                                </div>
                            </div>
                        </div>
                        <div class="reward-item">
                            <div class="reward-icon">üí∞</div>
                            <div class="reward-info">
                                <div class="reward-title">–ú–æ–Ω–µ—Ç—ã</div>
                                <div class="reward-value">
                                    {% if task.difficulty == 'easy' %}5
                                    {% elif task.difficulty == 'medium' %}10
                                    {% elif task.difficulty == 'hard' %}20
                                    {% elif task.difficulty == 'epic' %}40
                                    {% else %}8
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% if task.deadline %}
                        <div class="reward-item">
                            <div class="reward-icon">‚è±Ô∏è</div>
                            <div class="reward-info">
                                <div class="reward-title">–ë–æ–Ω—É—Å –∑–∞ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å</div>
                                <div class="reward-value">+15 XP</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="sidebar-card card">
                <div class="card-header">
                    <h3>–¢–∞–π–º–µ—Ä</h3>
                </div>
                <div class="card-body">
                    <div class="timer-display">
                        <div class="timer-circle magic-circle">
                            <div class="timer-value">00:00</div>
                        </div>
                        <div class="timer-controls">
                            <button id="timer-start" class="btn-small">–°—Ç–∞—Ä—Ç</button>
                            <button id="timer-pause" class="btn-small" disabled>–ü–∞—É–∑–∞</button>
                            <button id="timer-reset" class="btn-small" disabled>–°–±—Ä–æ—Å</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Timer functionality
        const timerDisplay = document.querySelector('.timer-value');
        const startBtn = document.getElementById('timer-start');
        const pauseBtn = document.getElementById('timer-pause');
        const resetBtn = document.getElementById('timer-reset');
        
        let timerInterval;
        let seconds = 0;
        
        function updateTimer() {
            seconds++;
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        startBtn.addEventListener('click', function() {
            timerInterval = setInterval(updateTimer, 1000);
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            resetBtn.disabled = false;
            
            // Add pulsing effect to timer
            document.querySelector('.timer-circle').classList.add('pulse');
        });
        
        pauseBtn.addEventListener('click', function() {
            clearInterval(timerInterval);
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            // Remove pulsing effect
            document.querySelector('.timer-circle').classList.remove('pulse');
        });
        
        resetBtn.addEventListener('click', function() {
            clearInterval(timerInterval);
            seconds = 0;
            timerDisplay.textContent = '00:00';
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            resetBtn.disabled = true;
            
            // Remove pulsing effect
            document.querySelector('.timer-circle').classList.remove('pulse');
        });
    });
</script>
{% endblock %}